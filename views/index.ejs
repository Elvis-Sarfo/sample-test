<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <!--Bootstrap 5.1.3-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://jeremyfagis.github.io/dropify/dist/css/dropify.min.css">
  <link rel='stylesheet' href='/stylesheets/style.css' />

</head>

<body>

  <div class="container">
    <div class="jumbotron">
      <h1>
        <%= title %>
      </h1>
      <p>Upload a Compamny PDF to Generate Report</p>
      <form id="form" action="/" method="post">
        <input type="file" name="file" id="file"  class="dropify" data-height="70">
        <input class="mt-2 mb-3 btn btn-primary" type="submit" value="Generate Report" name="submit">
      </form>
    </div>
  
    <div class="pt-2 text-justify" id="results"></div>
  
  </div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://jeremyfagis.github.io/dropify/dist/js/dropify.min.js"></script>
  <script>
    $('.dropify').dropify();
    window.onload = function () {
      
      // Get form element
      var form = document.getElementById('form');
      // Add submit event listener on it
      form.addEventListener('submit', function (e) {
        // Stop form submission
        e.preventDefault();
        // Get file reference from form
        var file = document.getElementById('file').files[0];
        // Create a new FormData object.
        var formData = new FormData();
        // Add the file to the request.
        formData.append('file', file);

        document.getElementById('results').innerHTML = 'Generating Report, Pleasr wait...';

        // Send post request with the fetch API
        fetch('/', {
          method: 'post',
          body: formData
        }).then(function (response) {
          if (response.ok) {
            return response.json();
          } else {
            throw new Error('Server response wasn\'t OK');
          }
        }).then(function (data) {
          // console.log(data?.result);
          // insert the generated html string into the DOM
          document.getElementById('results').innerHTML = data?.result;
        }).catch(function (error) {
          console.log(error);
          
        })
      });
    }
  </script>
</body>

</html>