<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>

    <form id="form" action="/" method="post">
      <input type="file" name="file" id="file">
      <input type="submit" value="Upload Image" name="submit">
    </form>

    <div id="results"></div>


    <script>
      window.onload = function() {
        // Get form element
        var form = document.getElementById('form');
        // Add submit event listener on it
        form.addEventListener('submit', function(e) {
          // Stop form submission
          e.preventDefault();
          // Get file reference from form
          var file = document.getElementById('file').files[0];
          // Create a new FormData object.
          var formData = new FormData();
          // Add the file to the request.
          formData.append('file', file);

          // Send post request with the fetch API
          fetch('/', {
            method: 'post',
            body: formData
          }).then(function(response) {
            if(response.ok) {
              return response.json();
            } else {
              throw new Error('Server response wasn\'t OK');
            }
          }).then(function(data) {
            // console.log(data?.result);
            // insert the generated html string into the DOM
            document.getElementById('results').innerHTML = data?.result;
          }).catch(function(error) {
            console.log(error);
          })
        });
      }
    </script>
  </body>
</html>
